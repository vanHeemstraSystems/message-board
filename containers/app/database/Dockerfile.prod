ARG IMAGE_REPOSITORY
# Use the official PostgreSQL image
FROM ${IMAGE_REPOSITORY}${IMAGE_REPOSITORY_DIVISION}postgres:14.15-alpine AS build

ENV POSTGRES_DB=message-board-db-prod
ENV POSTGRES_USER=db-user-prod
ENV POSTGRES_PASSWORD=db-password-prod

# Set the working directory in the container
WORKDIR /app

# Copy the application
COPY init.sql.prod /docker-entrypoint-initdb.d/init.sql
COPY postgresql.conf.prod /var/lib/postgresql/data/postgresql.conf

# Expose the port the app runs on
EXPOSE 5432

# Set the default command to run the application
CMD ["postgres", "-c", "config_file=/var/lib/postgresql/data/postgresql.conf"]